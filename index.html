<html>

<head>
<link rel="stylesheet" href="./accordion.css">
</head>

<body>
    <h1>ãƒ‰ãƒ¡ã‚¤ãƒ³ã—ã‚Šã¨ã‚Š</h1>

    <details id="accordion" class="accordion" open>
        <summary class="rule-summary">
          ãƒ«ãƒ¼ãƒ«
          <span class="open-close-icon" aria-hidden="true"></span>
        </summary>
        <div class="rule-container">
          <div class="rule-inner">
            <ol>
                <li>
                    <p>ãƒ‰ãƒ¡ã‚¤ãƒ³ã§ã—ã‚Šã¨ã‚Šã™ã‚‹</p>
                    <p>ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ä¾‹ï¼šwww.google.com, yahoo.co.jp, wikipedia.org</p>
                </li>
                <li>
                    <p>è‹±å­—(a-z)ãƒ»æ•°å­—(0-9)ãƒ»ãƒã‚¤ãƒ•ãƒ³(-)ãŒä½¿ç”¨å¯èƒ½</p>
                </li>
                <li>
                    <p>ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒå­˜åœ¨ã—ã¦ã„ãªã‘ã‚Œã°ã‚¢ã‚¦ãƒˆ</p>
                </li>
                <li>
                    <p>åŒã˜ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ä½¿ã£ãŸã‚‰ã‚¢ã‚¦ãƒˆ</p>
                    <p>ï¼ˆâ€»www.google.comã¨google.comã¯ç•°ãªã‚‹ï¼‰</p>
                </li>
                <li>
                    <p>ï¼“å›ã‚¢ã‚¦ãƒˆã§çµ‚äº†</p>
                </li>
                <!-- <li>
                    <p>ãƒ‰ãƒ¡ã‚¤ãƒ³ã®æ–‡å­—æ•°ãƒ»èªçŸ¥åº¦ãªã©ã‹ã‚‰ãƒã‚¤ãƒ³ãƒˆã‚’ç®—å‡º</p>
                </li> -->
            </ol>
          </div>
        </div>
    </details>


    <div class="player-container">
        <p class="heart" id="heart">â¤ï¸â¤ï¸â¤ï¸</p>
        <ol id="domain_list"><li>www.google.com</li></ol><!--  olã‚¿ã‚°ã‚’æ”¹è¡Œã—ãªã„ã“ã¨ -->
        <p id="warning_text" class="warning"></p>
        <input id="input" class="input" value="m" onInput="checkValidDomain()"><button id="submit_btn" onclick="submit()" disabled="true">ç¢ºå®š</button>
    </div>
    <footer class="footer">
        <p class="fotter-text">Ver. 0.1 Â© 2024 <a href="https://omine.me">omine.me</a></p>
    </footer>
    <section id="resultModal" class="modalArea">
        <div id="modalBg" class="modalBg"></div>
        <div class="modalWrapper">
          <div class="modalContents">
            <p>ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼</p>
            <button onclick="playAgain()">ã‚‚ã†ä¸€åº¦</button>
          </div>
        </div>
    </section>
</body>
<script src="./accordion.js"></script>
<style>
    body {
        font-family: sans-serif;
    }    
    .heart {
        font-size: 2rem;
    }
    .player-container {
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    .missed_domain {
        color: grey;
        text-decoration-line: line-through;
    }
    .warning {
        color: rgb(175, 0, 0);
        min-height: 1.5rem;
        margin: 0;
    }
    .input{
        padding: 0.7rem 1rem;
        font-size: 1.5rem;
    }
    .modalArea {
        display: none;
        position: fixed;
        z-index: 10; /*ã‚µã‚¤ãƒˆã«ã‚ˆã£ã¦ã“ã“ã®æ•°å€¤ã¯èª¿æ•´ */
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }
    .modalBg {
        width: 100%;
        height: 100%;
        background-color: rgba(30,30,30,0.9);
    }
    .modalWrapper {
        position: absolute;
        top: 50%;
        left: 50%;
        transform:translate(-50%,-50%);
        width: 70%;
        max-width: 500px;
        padding: 10px 30px;
        background-color: #fff;
    }
    .footer{
        width: 100%;
        text-align: center;
        background-color: gainsboro;
        margin: 7rem 0 0 0;
    }
    .fotter-text{
        padding: 0.5rem;
        color: #444;
    }
</style>
<script>
function submit() {
    input_val = document.getElementById("input");
    input_val.value = input_val.value.toLowerCase();
    if (input_val.value.slice(-1) === ".") {
        input_val.value = input_val.value.slice(0, -1);
    }
    domain = input_val.value;
    checkDomainExists(domain).then(result => {
        if (result.exists) {
          console.log("Domain exists.");
          addToDomainList(domain, true);
        } else {
            console.log("Domain does not exist.");
            addToDomainList(domain, false);
            updateRemainingLives();
        }
    });
    input_val.value = "";
    input_val.focus();
}
function checkValidDomain(){
    const domain = document.getElementById("input").value;
    if(domain === ""){
        document.getElementById("submit_btn").disabled = true;
        document.getElementById("warning_text").textContent = "";
        return;
    }

    // document.getElementById("domain_list")ã®liã‚¿ã‚°ã‚’å…¨éƒ¨å–å¾—ã—ã¦ã€doaminã¨æ¯”è¼ƒ
    const domain_list = document.getElementById("domain_list").getElementsByTagName("li");
    for(let i = 0; i < domain_list.length; i++){
        if(domain_list[i].textContent === domain){
            document.getElementById("submit_btn").disabled = true;
            document.getElementById("warning_text").textContent = "åŒã˜ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯ä½¿ãˆã¾ã›ã‚“";
            return;
        }
        if (i == domain_list.length - 1) {
            if(domain_list[i].textContent.slice(-1) !== domain.slice(0, 1)){
                document.getElementById("submit_btn").disabled = true;
                document.getElementById("warning_text").textContent = `ã—ã‚Šã¨ã‚Šã«ãªã£ã¦ã„ã¾ã›ã‚“ï¼ˆ${domain_list[i].textContent.slice(-1)}ã‹ã‚‰å§‹ã‚ã¾ã™ï¼‰`;
                return;
            }
        }
    }


    // if(domain.match(/^(?!-)[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+(\.)*(?!-)$/)){
    if(domain.match(/^[a-zA-Z0-9.-]+$/)){
        // å…ˆé ­ã‚„æœ«å°¾ã«ãƒã‚¤ãƒ•ãƒ³ãŒã‚ã‚‹ã‹
        if(domain[0] === "-"){
            document.getElementById("submit_btn").disabled = true;
            document.getElementById("warning_text").textContent = "å…ˆé ­ã«ãƒã‚¤ãƒ•ãƒ³(-)ã¯ä½¿ãˆã¾ã›ã‚“";
            return;
        }else if(domain.slice(-1) === "-"){
            document.getElementById("submit_btn").disabled = true;
            document.getElementById("warning_text").textContent = "æœ«å°¾ã«ãƒã‚¤ãƒ•ãƒ³(-)ã¯ä½¿ãˆã¾ã›ã‚“";
            return;
        }
        // å…ˆé ­ã«ãƒ‰ãƒƒãƒˆãŒãªã„ã‹
        if(domain[0] === "."){
            document.getElementById("submit_btn").disabled = true;
            document.getElementById("warning_text").textContent = "å…ˆé ­ã«ãƒ‰ãƒƒãƒˆ(.)ã¯ä½¿ãˆã¾ã›ã‚“";
            return;
        }
        // æœ«å°¾ä»¥å¤–ã«ä¸€ã¤ä»¥ä¸Šã®ãƒ‰ãƒƒãƒˆãŒã‚ã‚‹ã‹
        if(!domain.slice(0, -1).includes(".")){
            document.getElementById("submit_btn").disabled = true;
            document.getElementById("warning_text").textContent = "é€”ä¸­ã«ãƒ‰ãƒƒãƒˆ(.)ãŒã‚ã‚Šã¾ã›ã‚“";
            return;
        }

        document.getElementById("submit_btn").disabled = false;
        document.getElementById("warning_text").textContent = "";
    }else{
        document.getElementById("submit_btn").disabled = true;
        document.getElementById("warning_text").textContent = "ãƒ‰ãƒ¡ã‚¤ãƒ³ã®å½¢å¼ãŒé•ã„ã¾ã™(è‹±æ•°å­—ã¨ãƒã‚¤ãƒ•ãƒ³ã€ãƒ‰ãƒƒãƒˆã®ã¿)";
    }
}
function addToDomainList(domain, exists) {
    const domain_list = document.getElementById("domain_list");
    const child = document.createElement(exists ? "li" : "p");
    // pã«ã¯classã‚’è¿½åŠ 
    if(!exists){
        child.classList.add("missed_domain");
    }
    child.textContent = domain;
    domain_list.appendChild(child);
}
function updateRemainingLives() {
    const heart = document.getElementById("heart");
    // â¤ï¸ã®æ•°ã‚’å–å¾—
    const currentLives = heart.textContent.match(/â¤ï¸/g).length;
    if (currentLives === 1) {
        document.getElementById("resultModal").style.display = "block";
        return;
    }else{
        // æœ€å¾Œâ¤ï¸ã‚’æ¸›ã‚‰ã—ã¦ğŸ’”ã‚’è¿½åŠ 
        heart.textContent = heart.textContent.replace(/â¤ï¸(?!.*â¤ï¸)/, "ğŸ’”");
    }
}
async function checkDomainExists(domain) {
    const ipv4Url = `https://dns.google.com/resolve?name=${domain}&type=A`;
    const ipv6Url = `https://dns.google.com/resolve?name=${domain}&type=AAAA`;
  
    try {
      // ã¾ãšIPv4ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡
      const ipv4Response = await fetch(ipv4Url);
      const ipv4Data = await ipv4Response.json();
  
      // IPv4ãŒæˆåŠŸã—ã€StatusãŒ0ãªã‚‰ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯å­˜åœ¨ã™ã‚‹
      if (ipv4Data.Status === 0 && ipv4Data.Answer) {
        return { exists: true };
      }
    } catch (error) {
      // IPv4ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã€IPv6ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
      console.warn("IPv4 request failed, attempting IPv6...", error);
    }
  
    try {
      // IPv6ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡
      const ipv6Response = await fetch(ipv6Url);
      const ipv6Data = await ipv6Response.json();
  
      // IPv6ãŒæˆåŠŸã—ã€StatusãŒ0ãªã‚‰ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯å­˜åœ¨ã™ã‚‹
      if (ipv6Data.Status === 0 && ipv6Data.Answer) {
        return { exists: true };
      }
    } catch (error) {
      console.warn("IPv6 request also failed.", error);
    }
  
    // ã©ã¡ã‚‰ã‚‚å¤±æ•—ã¾ãŸã¯ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒå­˜åœ¨ã—ãªã„å ´åˆ
    return { exists: false };
}
function playAgain(){
    document.getElementById("resultModal").style.display = "none";
    document.getElementById("domain_list").innerHTML = "<li>www.google.com</li>";
    document.getElementById("heart").textContent = "â¤ï¸â¤ï¸â¤ï¸";
    document.getElementById("input").value = "m";
    document.getElementById("submit_btn").disabled = true;
    document.getElementById("warning_text").textContent = "";
    document.getElementById("input").focus();
}
</script>
</html>