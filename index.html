<!DOCTYPE html>
<html lang="ja">
<head>
    <title>ãƒ‰ãƒ¡ã‚¤ãƒ³ã—ã‚Šã¨ã‚Š</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="canonical" href="https://m-shiritori.omine.me" />
    <link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f494.svg">
    <meta name="format-detection" content="telephone=no" />
<link rel="stylesheet" href="./accordion.css">
</head>
<body>
    <div class="main_container">
        <h1><a href="">ãƒ‰ãƒ¡ã‚¤ãƒ³<wbr />ã—ã‚Šã¨ã‚Š</a><p class="title_en">Domain name word chain</p></h1>
        <details id="accordion" class="accordion" open>
            <summary class="rule-summary">
            ãƒ«ãƒ¼ãƒ«
            <span class="open-close-icon" aria-hidden="true"></span>
            </summary>
            <div class="rule-container">
            <div>
                <ul>
                    <li class="rule-text">
                        <p>ãƒ‰ãƒ¡ã‚¤ãƒ³ã§ã—ã‚Šã¨ã‚Šã™ã‚‹</p>
                        <p>ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ä¾‹ï¼šwww.google.com, yahoo.co.jp, wikipedia.org</p>
                    </li>
                    <li class="rule-text">
                        <p>è‹±å­—(a-z)ãƒ»æ•°å­—(0-9)ãƒ»ãƒã‚¤ãƒ•ãƒ³(-)ãƒ»ãƒ‰ãƒƒãƒˆ(.)ãŒä½¿ç”¨å¯èƒ½</p>
                    </li>
                    <li class="rule-text">
                        <span>ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒå­˜åœ¨ã—ã¦ã„ãªã‘ã‚Œã°ã‚¢ã‚¦ãƒˆ</span><span class="tooltip-container" tabindex="0">?<div class="tooltip-text">Public DNSã§ç¢ºèªã—ã¦DNS response codeãŒ0ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å­˜åœ¨ã™ã‚‹ã‚‚ã®ã¨ã™ã‚‹</div></span>
                    </li>
                    <li class="rule-text">
                        <p>åŒã˜ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯ä½¿ãˆãªã„</p>
                        <p>ï¼ˆâ€»www.google.comã¨google.comã¯ç•°ãªã‚‹ã®ã§OKï¼‰</p>
                    </li>
                    <li class="rule-text">
                        <p>ï¼“å›ã‚¢ã‚¦ãƒˆã§çµ‚äº†</p>
                    </li>
                    <li class="rule-text">
                        <p>ä¸–ç•Œä¸€æœ‰åãªãƒ‰ãƒ¡ã‚¤ãƒ³www.google.comã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆ</p>
                    </li>
                    <li class="rule-text">
                        <p>ãƒ‰ãƒ¡ã‚¤ãƒ³ã®æ–‡å­—æ•°ãªã©ã‹ã‚‰ãƒã‚¤ãƒ³ãƒˆã‚’ç®—å‡º</p>
                    </li>
                </ul>
            </div>
            </div>
        </details>
        <div class="player-container">
            <div class="hearts" id="hearts"></div>
            <ol class="domain_list" id="domain_list"></ol><!--  olã‚¿ã‚°ã‚’æ”¹è¡Œã—ãªã„ã“ã¨ -->
            <p id="warning_text" class="warning"></p>
            <div class="input_container">
            <input id="input" class="input" onInput="checkValidDomain()">
            <button id="submit_btn" class="submit_btn" onclick="submit()" disabled="true">
                <img class="submit_btn_img" src="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f50e.svg">
            </button>
            </div>
        </div>
    </div>
    <footer class="footer">
        <p class="fotter-text item-left">Using <a href="https://github.com/twitter/twemoji" target="_blank">Twemoji</a> by Twitter</p>
        <p class="fotter-text item-center">Ver. 1.0.2 Â© 2024 <a href="https://omine.me">omine.me</a></p>
    </footer>
    <section id="resultModal" class="modalArea">
        <div id="modalBg" class="modalBg"></div>
        <div class="modalWrapper">
          <div class="modalContents">
            <p class="resultTitle">ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼</p>
            <p class="resultPoint" id="resultPoint"></p>
            <div class="resultDomainListContainer" id="resultDomainListContainer"></div>
            <a class="shareBtn btn" id="shareBtn" href="" target="_blank">Xã§çµæœã‚’å…±æœ‰</a>
            <button class="btn" onclick="playAgain()">ã‚‚ã†ä¸€åº¦</button>
          </div>
        </div>
    </section>
</body>
<script src="./accordion.js"></script>
<style>
body {
font-family: sans-serif;
background-color: gainsboro;
margin: 0;
}
h1 {
text-align: center;
margin: 0;
padding: 2rem 0;
}
a {
text-decoration: none;
color: black;
}
.title_en {    
font-size: 1rem;
color: gray;
font-family: serif;
font-style: italic;
}
.main_container{
background-color: #fcfcfc;
padding: 0 10% 7rem 10%;
}
.heart {
width: 4rem;
}
.wiggle {
animation: wiggle .2s infinite;
}
@keyframes wiggle {
0% {transform: translate(0px, 0px) rotateZ(0deg)}
25% {transform: translate(2px, 2px) rotateZ(1deg)}
50% {transform: translate(0px, 2px) rotateZ(0deg)}
75% {transform: translate(2px, 0px) rotateZ(-1deg)}
100% {transform: translate(0px, 0px) rotateZ(0deg)}
}
.player-container {
display: flex;
flex-direction: column;
margin: 1rem 0;
align-items: center;
}
.domain_text {
overflow-wrap: anywhere;
}
.missed_domain {
color: grey;
text-decoration-line: line-through;
border-bottom: 1px solid;
border-color: lightgray;
}
.domain_list {
font-size: 1.7rem;
}
.domain_li_div {
display: flex;
justify-content: space-between;
align-items: baseline;
border-bottom: 1px solid;
border-color: lightgray;
}
.point_li {
font-style: italic;
color: #6b6b6b;
margin-left: 3rem;
font-size: 1.2rem;
text-align: right;
}
.point_li::after {
content: " pt";
}
.warning {
color: rgb(175, 0, 0);
min-height: 1.5rem;
margin: 0;
}
.input{
padding: 0 1rem;
font-size: 1.5rem;
height: 4rem;
border-radius: 1rem 0 0 1rem;
border: blue solid;
border-width: 1px 0 1px 1px;
max-width: 90%;
}
.input_container{
display: flex;
justify-content: center;
max-width: 90%;
}
.submit_btn_img{
width: 2.3rem;
}
.submit_btn{
padding: 0 1rem;
font-size: 1.5rem;
height: 4rem;
border-radius: 0 1rem 1rem 0;
border: blue solid 1px;
background-color: lightblue;
border-width: 1px 1px 1px 0;
}
.submit_btn:disabled{
background-color: lightgrey;
}
.modalArea {
display: none;
position: fixed;
z-index: 10;
top: 0;
left: 0;
width: 100%;
height: 100%;
}
.modalBg {
width: 100%;
height: 100%;
background-color: rgba(30,30,30,0.7);
}
.modalWrapper {
position: absolute;
top: 50%;
left: 50%;
transform:translate(-50%,-50%);
width: 70%;
border-radius: 1rem;
padding: 2rem;
background-color: #fff;
max-height: 90%;
overflow-y: scroll;
}
.modalContents {
display: flex;
flex-direction: column;
align-items: center;
}
.resultTitle {
font-size: 2rem;
}
.resultDomainListContainer{
width: 90%;
padding: 1rem;
border-radius: .5rem;
}
.resultPoint {
font-size: 3.5rem;
}
.shareBtn {
background-color: lightskyblue;
color: white;
}
.btn {
font-size: 1.3rem;
border-radius: 0.5rem;
padding: 0.8rem 1.5rem;
border: 1px solid black;
margin: 1rem 1rem 0;
cursor: pointer;
}
.footer{
width: 100%;
background-color: gainsboro;
display: flex;
flex-direction: row;
align-items: center;
justify-content: flex-start;
gap: 10px;
position: relative;
}
.fotter-text{
padding: 0.5rem;
color: #444;
}
.item-left {
margin-left: 0;
font-size: 0.8rem;
}
.item-center {
text-align: center;
position: absolute;
left: 50%;
transform: translateX(-50%);
margin-top: 0rem;
width: 100%;
}
@media (max-width: 800px) {
.footer {
flex-direction: column;
justify-content: flex-start;
}
.item-center {
margin-top: 2rem;
}
}
/* ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ— */
/* è¦ªè¦ç´  */
.tooltip-container {
position: relative;
overflow: hidden;
display: inline-block;
border: grey solid 1px;
border-radius: 50%;
background-color: lightblue;
margin: 0 0 0 0.5rem;
width: 1.2rem;
height: 1.2rem;
text-align: center;
color: #ffffff;
font-weight: bold;
}

/* ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ãƒ†ã‚­ã‚¹ãƒˆ */
.tooltip-text {
visibility: hidden;
width: 12rem;
background-color: #333;
color: #fff;
text-align: center;
border-radius: 5px;
padding: 8px;
position: absolute;
bottom: 125%;
left: 50%;
transform: translateX(-50%);
z-index: 1;
opacity: 0;
transition: opacity 0.3s;
}

/* ãƒ¢ãƒ¼ãƒ€ãƒ«ã®çŸ¢å° */
.tooltip-text::after {
content: "";
position: absolute;
top: 100%; /* ä¸‹æ–¹å‘ã«çŸ¢å°ã‚’è¡¨ç¤º */
left: 50%;
transform: translateX(-50%);
border-width: 5px;
border-style: solid;
border-color: #333 transparent transparent transparent;
}

/* ãƒã‚¦ã‚¹ã‚ªãƒ¼ãƒãƒ¼ã‚„ã‚¿ãƒƒãƒ—æ™‚ã«è¡¨ç¤º */
.tooltip-container:hover .tooltip-text,
.tooltip-container:focus-within .tooltip-text {
visibility: visible;
opacity: 1;
}
.tooltip-container:hover,
.tooltip-container:focus-within {
overflow: visible;
}
</style>
<script>
const heart_inter_html = '<img class="heart" src="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/2665.svg">';
const broken_heart_inter_html = '<img class="heart" data-isbroken="true" src="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f494.svg">';
function submit() {
    document.getElementById("submit_btn").disabled = true;
    input_val = document.getElementById("input");
    input_val.value = input_val.value.toLowerCase();
    // é€£ç¶šã™ã‚‹ãƒ‰ãƒƒãƒˆã‚’å‰Šé™¤
    input_val.value = input_val.value.replace(/\.{2,}/g, ".");
    if (input_val.value.slice(-1) === ".") {
        input_val.value = input_val.value.slice(0, -1);
    }
    domain = input_val.value;
    checkDomainExists(domain).then(result => {
        if (result.exists) {
          addToDomainList(domain, true);
        } else {
            addToDomainList(domain, false);
            updateRemainingLives();
        }
    });
    input_val.value = "";
    input_val.focus();
}
function checkValidDomain(){
    const domain = document.getElementById("input").value;
    if(domain === ""){
        document.getElementById("submit_btn").disabled = true;
        document.getElementById("warning_text").textContent = "";
        return;
    }

    // document.getElementById("domain_list")ã®liã‚¿ã‚°ã‚’å…¨éƒ¨å–å¾—ã—ã¦ã€doaminã¨æ¯”è¼ƒ
    const domain_list = document.getElementById("domain_list").getElementsByTagName("li");
    // make domain lowercase and remove last "."" if exists
    const sanitaized_domain = domain.toLowerCase().replace(/\.$/, "");
    for(let i = 0; i < domain_list.length; i++){
        // get first span of domain_list[i]
        list_domain_text = domain_list[i].getElementsByTagName("div")[0].getElementsByTagName("span")[0].textContent;
        if(list_domain_text === sanitaized_domain){
            document.getElementById("submit_btn").disabled = true;
            document.getElementById("warning_text").textContent = "åŒã˜ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯ä½¿ãˆã¾ã›ã‚“";
            return;
        }
        if (i == domain_list.length - 1) {
            if(list_domain_text.slice(-1) !== domain.slice(0, 1).toLowerCase()){
                document.getElementById("submit_btn").disabled = true;
                document.getElementById("warning_text").textContent = `ã—ã‚Šã¨ã‚Šã«ãªã£ã¦ã„ã¾ã›ã‚“ï¼ˆ${list_domain_text.slice(-1)}ã‹ã‚‰å§‹ã‚ã¾ã™ï¼‰`;
                return;
            }
        }
    }

    if(domain.match(/^[a-zA-Z0-9.-]+$/)){
        // å…ˆé ­ã«ãƒ‰ãƒƒãƒˆãŒãªã„ã‹
        if(domain[0] === "."){
            document.getElementById("submit_btn").disabled = true;
            document.getElementById("warning_text").textContent = "å…ˆé ­ã«ãƒ‰ãƒƒãƒˆ(.)ã¯ä½¿ãˆã¾ã›ã‚“";
            return;
        }
        //é€£ç¶šã™ã‚‹ãƒ‰ãƒƒãƒˆãŒãªã„ã‹
        if(domain.match(/\.{2,}/)){
            document.getElementById("submit_btn").disabled = true;
            document.getElementById("warning_text").textContent = "ãƒ‰ãƒƒãƒˆ(.)ã¯é€£ç¶šã§ã¯ä½¿ãˆã¾ã›ã‚“";
            return;
        }
        // æœ«å°¾ä»¥å¤–ã«ä¸€ã¤ä»¥ä¸Šã®ãƒ‰ãƒƒãƒˆãŒã‚ã‚‹ã‹
        if(!domain.slice(0, -1).includes(".")){
            document.getElementById("submit_btn").disabled = true;
            document.getElementById("warning_text").textContent = "é€”ä¸­ã«ãƒ‰ãƒƒãƒˆ(.)ãŒã‚ã‚Šã¾ã›ã‚“";
            return;
        }
        // å…ˆé ­ã‚„æœ«å°¾ã«ãƒã‚¤ãƒ•ãƒ³ãŒã‚ã‚‹ã‹
        if(domain[0] === "-"){
            document.getElementById("submit_btn").disabled = true;
            document.getElementById("warning_text").textContent = "å…ˆé ­ã«ãƒã‚¤ãƒ•ãƒ³(-)ã¯ä½¿ãˆã¾ã›ã‚“";
            return;
        }
        if(domain.slice(-1) === "-"){
            document.getElementById("submit_btn").disabled = true;
            document.getElementById("warning_text").textContent = "æœ«å°¾ã«ãƒã‚¤ãƒ•ãƒ³(-)ã¯ä½¿ãˆã¾ã›ã‚“";
            return;
        }

        document.getElementById("submit_btn").disabled = false;
        document.getElementById("warning_text").textContent = "";
    }else{
        // ç©ºç™½ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆ
        if(domain.match(/\s/)){
            document.getElementById("submit_btn").disabled = true;
            document.getElementById("warning_text").textContent = "ç©ºç™½ã¯ä½¿ãˆã¾ã›ã‚“";
            return;
        }

        document.getElementById("submit_btn").disabled = true;
        document.getElementById("warning_text").textContent = "ãƒ‰ãƒ¡ã‚¤ãƒ³ã®å½¢å¼ãŒé•ã„ã¾ã™(è‹±æ•°å­—ã¨ãƒã‚¤ãƒ•ãƒ³ã€ãƒ‰ãƒƒãƒˆã®ã¿)";
    }
}
function addToDomainList(domain, exists) {
    if (exists){
        // <li><div class="domain_li></div><li>
        var child = document.createElement("li");
        child.innerHTML = `<div class="domain_li_div"><span class="domain_text">${domain}</span><span class="point_li">${calcPoint(domain)}</span></div>`;
    }else{
        // <div class="missed_domain"></div>
        var child = document.createElement("div");
        child.classList.add("missed_domain");
        child.innerHTML = `<span class="domain_text">${domain}</span>`;
    }
    document.getElementById("domain_list").appendChild(child);
}
function calcPoint(domain){
    let point = 0;
    // ãƒ‰ãƒ¡ã‚¤ãƒ³ã®æ–‡å­—æ•°ã«å¿œã˜ã¦ãƒã‚¤ãƒ³ãƒˆã‚’è¿”ã™
    const domain_length = domain.length
    point += 1.5 ** domain_length;

    // tldã®ãƒã‚¤ãƒ³ãƒˆ
    const tld = domain.split(".").pop();
    // top 3 non ccTLD TLD: com, net, org
    // 2 - 1/(x)
    if (tld=="com"){
        point *= (2 - 1/1);
    }
    else if (tld=="net"){
        point *= (2 - 1/2);
    }
    else if (tld=="org"){
        point *= (2 - 1/3);
    }
    else{
        point *= 2;
    }

    // ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã®æ•°ã«å¿œã˜ã¦ãƒã‚¤ãƒ³ãƒˆã‚’è¿½åŠ 
    const subdomain_count = domain.split(".").length-1;
    point *= (1.5 ** (subdomain_count-1));

    return parseInt(point);
}
function updateRemainingLives() {
    const hearts = document.getElementById("hearts");
    // count the number of broken hearts
    const brokenHearts = hearts.querySelectorAll("img[data-isbroken]").length;
    if (brokenHearts === 2) {
        document.getElementById("resultModal").style.display = "block";
        document.getElementById("resultDomainListContainer").innerHTML = document.getElementById("domain_list").outerHTML;
        const pt = getPointSum();
        document.getElementById("resultPoint").innerHTML = pt + " pt!";
        const domain_count = document.getElementById("domain_list").getElementsByTagName("li").length;
        document.getElementById("shareBtn").href = `https://twitter.com/intent/tweet?text=ãƒ‰ãƒ¡ã‚¤ãƒ³ã—ã‚Šã¨ã‚Šã§${domain_count}é€£ç¶šã§ã—ã‚Šã¨ã‚Šã—ã¦ã€ã‚¹ã‚³ã‚¢ã¯${pt}ptã§ã—ãŸï¼&url=${location.href}`;
        return;
    } else {
        if (brokenHearts === 1) {
            hearts.classList.add("wiggle");
        }
        // æœ€å¾Œâ¤ï¸ã‚’æ¸›ã‚‰ã—ã¦ğŸ’”ã‚’è¿½åŠ 
        hearts.innerHTML = heart_inter_html.repeat(3 - (brokenHearts+1)) + broken_heart_inter_html.repeat(brokenHearts+1);
    }
}
function getPointSum(){
    let sum = 0;
    const domain_list = document.getElementById("domain_list").getElementsByTagName("li");
    for(let i = 0; i < domain_list.length; i++){
        // get first span of domain_list[i]
        point = domain_list[i].getElementsByTagName("div")[0].getElementsByTagName("span")[1].textContent;
        sum += parseInt(point);
    }
    return sum;
}
async function checkDomainExists(domain) {
    const ipv4Url = `https://dns.google.com/resolve?name=${domain}&type=A`;
    const ipv6Url = `https://dns.google.com/resolve?name=${domain}&type=AAAA`;
  
    try {
      // ã¾ãšIPv4ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡
      const ipv4Response = await fetch(ipv4Url);
      const ipv4Data = await ipv4Response.json();
  
      // IPv4ãŒæˆåŠŸã—ã€StatusãŒ0ãªã‚‰ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯å­˜åœ¨ã™ã‚‹
      if (ipv4Data.Status === 0 && ipv4Data.Answer) {
        return { exists: true };
      }
    } catch (error) {
      // IPv4ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã€IPv6ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
      console.warn("IPv4 request failed, attempting IPv6...", error);
    }
  
    try {
      // IPv6ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡
      const ipv6Response = await fetch(ipv6Url);
      const ipv6Data = await ipv6Response.json();
  
      // IPv6ãŒæˆåŠŸã—ã€StatusãŒ0ãªã‚‰ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯å­˜åœ¨ã™ã‚‹
      if (ipv6Data.Status === 0 && ipv6Data.Answer) {
        return { exists: true };
      }
    } catch (error) {
      console.warn("IPv6 request also failed.", error);
    }
  
    // ã©ã¡ã‚‰ã‚‚å¤±æ•—ã¾ãŸã¯ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒå­˜åœ¨ã—ãªã„å ´åˆ
    return { exists: false };
}
function playAgain(){
    document.getElementById("resultModal").style.display = "none";
    document.getElementById("domain_list").innerHTML = '<li><div class="domain_li_div"><span class="domain_text">www.google.com</span><span class="point_li">0</span></div></li>';
    document.getElementById("hearts").innerHTML = heart_inter_html.repeat(3);
    document.getElementById("hearts").classList.remove("wiggle");
    document.getElementById("submit_btn").disabled = true;
    document.getElementById("warning_text").textContent = "";
    document.getElementById("input").value = "m";
    document.getElementById("input").focus();
}
playAgain();
window.addEventListener('beforeunload', function (e) {
    e.preventDefault();
    e.returnValue = 'é·ç§»';
});
</script>
</html>